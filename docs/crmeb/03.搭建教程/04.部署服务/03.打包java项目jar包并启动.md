---
title: æ‰“åŒ…Javaé¡¹ç›®jarå¹¶å¯åŠ¨
date: 2021-12-22 12:37:44
permalink: /pages/crmeb/java-build-run/
categories:
  - crmeb
  - å®‰è£…æ•™ç¨‹
tags:
  - 
---
# Crmeb Java é¡¹ç›®æ‰“åŒ…å¯è¿è¡Œjaræ–‡ä»¶

æœ¬åœ°å·²ç»è¿è¡Œè¿‡çš„åŒå­¦ç›´æ¥é…ç½®prodç¯å¢ƒçš„ymlæ–‡ä»¶åç›´æ¥mvn install æ‰“åŒ…å³å¯ã€‚

## â¬ä¸‹è½½çš„æºç ï¼Œå¹¶å¯¼å…¥å¼€å‘å·¥å…·

è§£å‹åçš„ä»£ç åŒ…å†…å®¹

![æºç åŒ…åŸºæœ¬å†…å®¹ä»‹ç»](http://pic.xbdzz.cn/write/202203281444821.png)

è§£å‹åå¯¼å…¥ideaå¼€å‘å·¥å…·ï¼Œåˆæ¬¡å¯¼å…¥ä¼šè‡ªåŠ¨æ ¹æ®pomæ–‡ä»¶ä¸‹è½½å¯¹åº”çš„jaråŒ…ã€‚

![ä¸‹è½½jarï¼Œå–å†³äºä½ çš„ç½‘é€Ÿ](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203261556769.png)

## ğŸ”—æ­£ç¡®å¯¼å…¥javaé¡¹ç›®å¹¶é…ç½®mysqlå’Œredisé“¾æ¥

![æ­£ç¡®å¯¼å…¥Javaé¡¹ç›®](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203261558982.png)

 é…ç½®æ•°æ®åº“è¿æ¥å’Œ

![æ‰“åŒ…jaræ–‡ä»¶](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203261626692.png)

æ‰“åŒ…ä¹‹å‰ä¿®æ”¹ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«åœ¨crmeb-admin å’Œ crmeb-frontåŒ…ä¸‹çš„ ymlï¼Œæ¯ä¸ªç¯å¢ƒä¸­çš„ç«¯å£éƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œé»˜è®¤adminä¸º20000frontä¸º20001 ä¸Šä¼ åˆ°æœåŠ¡ç«¯å£è½¬å‘ä¼šç”¨åˆ°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±è¦æ±‚è°ƒæ•´ï¼Œä¸è¦ä¸å†²çªå³å¯ã€‚

crmeb-admin		AdminæœåŠ¡		 æ‰“åŒ…åäº§å‡ºCrmeb-admin.jar

crmeb-comm		å…¬å…±æœåŠ¡   		 ä¼šæ‰“åŒ…åˆ°adminå’Œfrontä¸­

crmeb-front   		å•†åŸæœåŠ¡			æ‰“åŒ…åäº§å‡ºCrmeb-front.jar

crmeb-service		å…¬å…±ä¸šåŠ¡			ä¼šæ‰“åŒ…åˆ°adminå’Œfrontä¸­

crmebiamge			ç´ æåŒ…				çº¿ä¸Šéƒ¨ç½²æ—¶éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå°†è·¯å¾„é…ç½®åˆ°java é…ç½®æ–‡ä»¶ä¸­

âœ…æ‰“åŒ…æˆåŠŸ

![æ‰“åŒ…Jaræ–‡ä»¶æˆåŠŸ](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203261637385.png)

æ‰“åŒ…ååœ¨å¯¹åº”ç›®å½•è·å–åˆ°Crmeb-admin.jar å’Œ Crmeb-front.jar å¹¶å‘å¸ƒåˆ°å®å¡”åˆ›å»ºçš„ä¸¤ä¸ªapi.xxxçš„åŸŸåä¸‹ã€‚

ä¸Šä¼ ä»£ç åˆ°æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨è‡ªå·±è¶æ‰‹çš„å·¥å…·ï¼Œftpæˆ–è€…ssh è¿™é‡Œä¸ºäº†ç»Ÿä¸€ï¼Œéƒ½æ˜¯ç”¨å®å¡”é¢æ¿æ“ä½œã€‚

![è·å–æ‰“åŒ…åçš„jaræ–‡ä»¶](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281048079.png)

ä¸Šä¼ æ‰“åŒ…å¥½çš„ä¸¤ä¸ªjaræ–‡ä»¶åˆ°åˆ›å»ºå¥½çš„ç«™ç‚¹æ ¹ç›®å½•

![ä¸Šä¼ jaråˆ°å®å¡”å¯¹åº”apiç«™ç‚¹](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281052132.png)

å¦‚ä¸‹å›¾ï¼Œä»¥adminæœåŠ¡ä¸ºä¾‹ ä¸Šä¼ Crmeb-admin.jar ï¼Œå¯åŠ¨jarçš„shellï¼Œå’Œåˆå§‹åŒ–ç´ æåŒ… shellæ–‡ä»¶å’Œç´ æåŒ…éƒ½åœ¨å‹ç¼©åŒ…ä¸­ã€‚

![ä¸Šä¼ jarå’Œshellè„šæœ¬](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281109524.png)

> æ³¨æ„: shellè„šæœ¬åœ¨æ‰§è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°æ ¼å¼ä¸æ­£ç¡®çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨æœ¬åœ°ä¿®æ”¹å¥½åœ¨bté¢æ¿ä¸­åˆ›å»º.shæ–‡ä»¶ç›´æ¥ç²˜è´´è¿›å»å°±å¥½ã€‚

âš ï¸ç´ æè¯´æ˜ï¼šä¸Šå›¾ä¸­crmebimageç›®å½•éœ€è¦åœ¨admin å¯¹åº”ç¯å¢ƒçš„ ymlä¸­æå‰é…ç½®å¥½ï¼Œç›®å½•å±‚çº§åˆ°crmebimageçš„ç¬¬ä¸€å±‚ç›®å½•ã€‚

ç‚¹å‡»start.shæ–‡ä»¶ä¿®æ”¹è·¯å¾„ï¼Œstop.sh ä¸€èˆ¬ä¸éœ€è¦é‡å¯ç›´æ¥æ‰§è¡Œstart.shæ–‡ä»¶ï¼Œåœæ­¢æ—¶ä¸€èˆ¬æ‰‹åŠ¨killï¼Œå¦‚æœéœ€è¦stop.shè„šæœ¬åŒæ ·é…ç½®ç›®å½•å³å¯ã€‚

![ä¿®æ”¹å¯åŠ¨è„šæœ¬](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281128937.png)

åŒæ ·frontä¹Ÿä¸Šä¼ jarå’Œè„šæœ¬åˆ°å¯¹åº”ç›®å½•å³å¯ï¼Œç´ æè‡ªåœ¨adminç«¯é…ç½®ã€‚

ä¸‡äº‹ä¿±å¤‡ï¼Œå¼€å§‹å¯åŠ¨jarç¨‹åºã€‚

é“¾æ¥SSHå®¢æˆ·ç«¯

![å®å¡”ä¸­æ‰“å¼€ç»ˆç«¯](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281138409.png)

æ‰§è¡Œå¯åŠ¨å‘½ä»¤

![image-20220328113605612](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281136685.png)

â˜•ï¸admin.jar å¯åŠ¨æˆåŠŸï¼Œè¿™é‡Œä¸å†åˆ—ä¸¾frontçš„ä¸Šä¼ å’Œå¯åŠ¨ï¼Œå’Œadminä¸€æ ·çš„æ“ä½œå³å¯ï¼Œfrontä¸ç”¨é…ç½®ç´ æçš„å·®å¼‚å…¶ä»–ä¸€è‡´ã€‚

![å¯åŠ¨Javaç¨‹åºæˆåŠŸ](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281145850.png)

### è®¾ç½®ä»£ç† å¯¹å¤–æä¾›apiæœåŠ¡

åœ¨æ²¡æœ‰è®¾ç½®ä»£ç†ä¹‹å‰çš„apiç«™ç‚¹è®¿é—®æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œéœ€è¦ç¡®è®¤åŸŸåè§£æå’Œå®å¡”ä¸­åˆ›å»ºç«™ç‚¹å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ã€‚

![ä»£ç†ä¹‹å‰çš„apiç«™ç‚¹](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281149523.png)

![image-20220328115212668](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281152707.png)

è®¾ç½®AdminæœåŠ¡ä»£ç†ç«¯å£

![è®¾ç½®adminAPIä»£ç†](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281154830.png)

è®¿é—®admin swaggeræ–‡æ¡£ï¼šè®¿é—®æ–¹å¼ | http://åŸŸå/doc.html

![è®¿é—®admin swaggeræ–‡æ¡£](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281158285.png)

åŒæ ·è®¿é—®front api éœ€è¦å’Œadmin jar ä¸€æ ·æ­£ç¡®éƒ¨ç½²å¹¶ä¸”å¯åŠ¨åï¼Œè®¾ç½®ä»£ç†ç«¯å£ é»˜è®¤20001 å¦‚æœæœ‰ä¿®æ”¹ä»¥è‡ªå·±ä¿®æ”¹çš„ç«¯å£ä¸ºå‡†ã€‚

![front jar Swagger](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202203281205324.png)

ä»¥ä¸Šæ­¥éª¤å·²ç»å°†javaå…¨éƒ¨æœåŠ¡å¯åŠ¨æˆåŠŸï¼

# **å®å¡”å•æœºnginxè´Ÿè½½å‡è¡¡é›†ç¾¤éƒ¨ç½² å¦‚æœéœ€è¦**

1. æ·»åŠ ç«™ç‚¹ï¼ˆæ­¤å¤„ä¸åšè¯¦è¿°ï¼‰

2. ç«™ç‚¹è®¾ç½®â€”ç½‘ç«™ç›®å½•ï¼Œå…³é—­é˜²è·¨è½¬æ”»å‡»

![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251122019.png)

3. ç«™ç‚¹è®¾ç½®â€”æ·»åŠ åå‘ä»£ç†

![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251122782.png)

4. ç«™ç‚¹è®¾ç½®â€”é…ç½®æ–‡ä»¶

   æ­¤å¤„å› ä¸ºæ˜¯æœ¬åœ°æµ‹è¯•ï¼Œä½¿ç”¨IP+ç«¯å£ï¼Œéœ€è¦åœ¨ä¹‹å‰çš„é¡¹ç›®åŒçº§ç›®å½•ä¸‹åˆ›å»ºfront2ç›®å½•ï¼Œå†èµ·ä¸€ä¸ªç§»åŠ¨ç«¯é¡¹ç›®ï¼Œä¸‹å›¾çš„ç«¯å£å°±æ˜¯åŸfront1ï¼Œä¸front2çš„å¯åŠ¨ç«¯å£ï¼Œå¯åŠ¨ç«¯å£å¯ä»¥åœ¨é¡¹ç›®ä¸­application-*.ymlæ–‡ä»¶ä¸­çš„server:port:ç«¯å£,è¿™é‡Œä¿®æ”¹
   ![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251122651.png)

5. é…ç½®æ–‡ä»¶ç¡®è®¤ï¼ˆç¡®è®¤upstream åçš„åŒºå—åç§°æ˜¯å¦ä¸€è‡´ï¼‰

```shell
1. /www/server/panel/vhost/nginx/ç«™ç‚¹åŸŸå.confæ–‡ä»¶ï¼Œç‚¹å‡»ç¼–è¾‘
```

![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251123321.png)

```shell
2. /www/server/panel/vhost/nginx/proxy/ç«™ç‚¹åŸŸåæ–‡ä»¶å¤¹/æ–‡ä»¶ï¼Œç‚¹å‡»ç¼–è¾‘
```

![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251123751.png)

6. é…ç½®å®Œæˆï¼Œä¸ºç¡®ä¿ç”Ÿæ•ˆå¯ä»¥é‡å¯nginx

7. è§£å†³nginxè´Ÿè½½å‡è¡¡åï¼Œfontçš„Swaggeræ–‡æ¡£è®¿é—®é—®é¢˜

   åœ¨/www/server/panel/vhost/nginx/proxy/ç«™ç‚¹åŸŸåæ–‡ä»¶å¤¹/æ–‡ä»¶ï¼Œç‚¹å‡»ç¼–è¾‘ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç 
   ![img](http://fastly.jsdelivr.net/gh/xbdazz/mypic/img/202112251123736.png)
   ä¾‹ï¼š

```
location ~* ^(/v2|/webjars|/swagger-resources|/doc.html) {   proxy_set_header Host $host;   proxy_set_header  X-Real-IP  $remote_addr;   proxy_set_header X-Forwarded-For $remote_addr;   #proxy_set_header Host $host:$server_port;   proxy_set_header X-Forwarded-Proto $scheme;   proxy_set_header X-Forwarded-Port $server_port;   proxy_pass http://000.00.111.22:8081; # åç«¯æœåŠ¡åœ°å€}
```

#### é™„å½•ï¼š

æ‰©å±•nginxçš„äº”ç§è´Ÿè½½ç®—æ³•åŠæ‰©å±•

1. è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æŸå°æœåŠ¡å™¨æ­»æœºï¼Œæ•…éšœç³»ç»Ÿè¢«è‡ªåŠ¨å‰”é™¤ï¼Œä½¿ç”¨æˆ·è®¿é—®ä¸å—å½±å“ã€‚
2. Weightï¼ŒæŒ‡å®šè½®è¯¢æƒå€¼ï¼ŒWeightå€¼è¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚åˆ†é…åˆ°çš„è®¿é—®æœºç‡è¶Šé«˜ï¼Œä¸»è¦ç”¨äºåç«¯æ¯ä¸ªæœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µä¸‹ã€‚
   ä¾‹ï¼š

```
upstream my_server {   server 192.168.0.14 weight=10;   server 192.168.0.15 weight=10;}
```

3. ip_hashï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ªIPçš„è®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„sessionå…±äº«é—®é¢˜ã€‚
   ä¾‹ï¼š

```
upstream my_server {ip_hash;server 192.168.0.14:88;server 192.168.0.15:80;}
```

4. fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰
   æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´åŠ æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒfairçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»ä¸‹è½½Nginxçš„upstream_fairæ¨¡å—ã€‚
   ä¾‹ï¼š

```
upstream my_server {  server 192.168.0.14;  server 192.168.0.15;}
```

5. url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰
   æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åç«¯ç¼“å­˜æœåŠ¡å™¨çš„æ•ˆç‡ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒurl_hashçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»å®‰è£…Nginx çš„hashè½¯ä»¶åŒ…ã€‚
   åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•
   ä¾‹ï¼š

```
upstream my_server {  server 192.168.0.14:80;  server 192.168.0.15:80;  hash $request_uri;  hash_method crc32;}
```

#### Tips:

```
upstream bakend{  #å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€  ip_hash;  server 1192.168.0.14:80 down;  server 192.168.0.15:80 weight=2;  server 127.0.0.1:8081;  server 127.0.0.1:7070 backup;}
```

ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ æ‰“åŒ…è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ç­‰é—®é¢˜ç¯å¢ƒè®ºå›æé—® [Javaç³»ç»Ÿ - CRMEBç¤¾åŒº](https://q.crmeb.com/?categoryId=122&sequence=0)
